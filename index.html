<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>DMP3 AR Experience</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no" />

  <!-- A-Frame + MindAR -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }

    /* Blue circular button with white SVG icon (shared by both posters) */
    .btn {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 70px;
      height: 70px;
      background: #1e5df8;
      border-radius: 50%;
      z-index: 1000;
      user-select: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 24px rgba(30, 93, 248, 0.35);
      transition: transform 0.1s ease;
      touch-action: manipulation;
      pointer-events: auto;
    }
    .btn:active { transform: scale(0.96); }
    .btn svg { width: 34px; height: 34px; fill: white; }

    /* Pill CTA buttons (center-bottom) */
    .cta-pill {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 20px;
      background: #1e5df8;
      color: #fff;
      border-radius: 30px;
      padding: 14px 22px;
      font-size: 16px;
      font-weight: 600;
      z-index: 1000;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 8px 24px rgba(30, 93, 248, 0.35);
      white-space: nowrap;
      pointer-events: auto;
    }

    .hidden { display: none !important; }

    /* Close button */
    #closeBtn {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 55px;
      height: 55px;
      background: rgba(0,0,0,0.7);
      color: white;
      font-size: 26px;
      text-align: center;
      line-height: 55px;
      border-radius: 50%;
      z-index: 1000;
      cursor: pointer;
      pointer-events: auto;
    }

    /* Audio unlock */
    #audioOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      z-index: 2000;
      cursor: pointer;
      pointer-events: auto;
      padding: 24px;
    }
  </style>
</head>

<body>

  <!-- =================== AR Scene =================== -->
  <a-scene
    mindar-image="imageTargetSrc: ./assets/targets.mind;"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: true">

    <a-assets>
      <video id="videoAsset" src="./assets/video.mp4" preload="auto" loop crossorigin="anonymous" playsinline></video>
      <a-asset-item id="modelAsset" src="./assets/quantum-model-shaded.glb"></a-asset-item>
      <audio id="voiceAsset" src="./assets/quantum-voiceover.mp3"></audio>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <!-- Poster 1 -->
    <a-entity mindar-image-target="targetIndex: 0" id="targetP1">
      <a-video id="arVideo" src="#videoAsset" width="1.6" height="0.9" visible="false"></a-video>
    </a-entity>

    <!-- Poster 2 -->
    <a-entity mindar-image-target="targetIndex: 1" id="targetP2">
      <a-entity id="modelEntity"
        gltf-model="#modelAsset"
        scale="0.7 0.7 0.7"
        rotation="0 0 0"
        visible="false">
      </a-entity>
    </a-entity>

  </a-scene>

  <!-- =================== OVERLAY UI =================== -->

  <!-- Poster 1 CTA -->
  <div id="playVideoCTA_p1" class="cta-pill hidden">Play video</div>

  <!-- Poster 1 Play/Pause -->
  <div id="togglePlayPauseBtn_p1" class="btn hidden">
    <svg id="iconPlay_p1" viewBox="0 0 100 100">
      <polygon points="30,20 80,50 30,80"></polygon>
    </svg>
    <svg id="iconPause_p1" style="display:none;" viewBox="0 0 100 100">
      <rect x="25" y="20" width="18" height="60"></rect>
      <rect x="57" y="20" width="18" height="60"></rect>
    </svg>
  </div>

  <!-- Poster 2 CTA -->
  <div id="tellMeMoreBtn_p2" class="cta-pill hidden">Tell me more</div>

  <!-- Poster 2 Play/Pause -->
  <div id="togglePlayPauseBtn_p2" class="btn hidden">
    <svg id="iconPlay_p2" viewBox="0 0 100 100">
      <polygon points="30,20 80,50 30,80"></polygon>
    </svg>
    <svg id="iconPause_p2" style="display:none;" viewBox="0 0 100 100">
      <rect x="25" y="20" width="18" height="60"></rect>
      <rect x="57" y="20" width="18" height="60"></rect>
    </svg>
  </div>

  <!-- Close -->
  <div id="closeBtn" class="hidden">âœ•</div>

  <!-- Audio unlock -->
  <div id="audioOverlay">Tap to Enable Sound</div>

  <script>
    window.onload = () => {

      // ELEMENTS
      const video = document.querySelector('#videoAsset');
      const arVideo = document.querySelector('#arVideo');
      const voice = document.querySelector('#voiceAsset');
      const model = document.querySelector('#modelEntity');

      const targetP1 = document.querySelector('#targetP1');
      const targetP2 = document.querySelector('#targetP2');

      const playCTA = document.getElementById('playVideoCTA_p1');
      const playBtnP1 = document.getElementById('togglePlayPauseBtn_p1');
      const iconPlayP1 = document.getElementById('iconPlay_p1');
      const iconPauseP1 = document.getElementById('iconPause_p1');

      const tellCTA = document.getElementById('tellMeMoreBtn_p2');
      const playBtnP2 = document.getElementById('togglePlayPauseBtn_p2');
      const iconPlayP2 = document.getElementById('iconPlay_p2');
      const iconPauseP2 = document.getElementById('iconPause_p2');

      const closeBtn = document.getElementById('closeBtn');
      const audioOverlay = document.getElementById('audioOverlay');

      let active = null;

      // Helpers
      const show = el => el.classList.remove('hidden');
      const hide = el => el.classList.add('hidden');

      function updateP1() {
        const paused = video.paused;
        iconPlayP1.style.display = paused ? 'block' : 'none';
        iconPauseP1.style.display = paused ? 'none' : 'block';
      }

      function updateP2() {
        const paused = voice.paused;
        iconPlayP2.style.display = paused ? 'block' : 'none';
        iconPauseP2.style.display = paused ? 'none' : 'block';
      }

      // AUDIO UNLOCK
      audioOverlay.addEventListener('click', () => {
        video.muted = false;
        voice.muted = false;

        video.play().then(() => video.pause());
        voice.play().then(() => voice.pause());

        audioOverlay.style.display = 'none';
      });

      // POSTER 1
      targetP1.addEventListener('targetFound', () => {
        active = 'p1';
        voice.pause();
        voice.currentTime = 0;

        arVideo.object3D.visible = true;

        show(playCTA);
        hide(playBtnP1);
        show(closeBtn);

        hide(tellCTA);
        hide(playBtnP2);
      });

      targetP1.addEventListener('targetLost', () => {
        video.pause();
        arVideo.object3D.visible = false;

        hide(playCTA);
        hide(playBtnP1);
        hide(closeBtn);

        active = null;
      });

      playCTA.addEventListener('click', () => {
        video.play();
        hide(playCTA);
        show(playBtnP1);
        updateP1();
      });

      playBtnP1.addEventListener('click', () => {
        if (video.paused) video.play(); else video.pause();
        updateP1();
      });

      // POSTER 2
      targetP2.addEventListener('targetFound', () => {
        active = 'p2';
        video.pause();

        model.setAttribute('visible', true);

        show(tellCTA);
        hide(playBtnP2);
        show(closeBtn);

        hide(playCTA);
        hide(playBtnP1);
      });

      targetP2.addEventListener('targetLost', () => {
        voice.pause();
        voice.currentTime = 0;

        model.setAttribute('visible', false);

        hide(tellCTA);
        hide(playBtnP2);
        hide(closeBtn);

        active = null;
      });

      tellCTA.addEventListener('click', () => {
        voice.play();
        hide(tellCTA);
        show(playBtnP2);
        updateP2();
      });

      playBtnP2.addEventListener('click', () => {
        if (voice.paused) voice.play(); else voice.pause();
        updateP2();
      });

      // CLOSE
      closeBtn.addEventListener('click', () => {
        if (active === 'p1') {
          video.pause();
          video.currentTime = 0;
          arVideo.object3D.visible = false;
          hide(playCTA);
          hide(playBtnP1);
        }

        if (active === 'p2') {
          voice.pause();
          voice.currentTime = 0;
          model.setAttribute('visible', false);
          hide(tellCTA);
          hide(playBtnP2);
        }

        hide(closeBtn);
        active = null;
      });

      hide(playCTA);
      hide(playBtnP1);
      hide(playBtnP2);
      hide(tellCTA);
      hide(closeBtn);

      updateP1();
      updateP2();

    };
  </script>

</body>
</html>
